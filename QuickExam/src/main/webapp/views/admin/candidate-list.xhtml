<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">
<f:view>
    <ui:composition template="sidebar.xhtml">
        <ui:define name="title">Candidate Management</ui:define>

        <ui:define name="content">
            <!-- Main container with fixed height for scrolling -->
            <div style="height: calc(100vh - 80px); overflow-y: auto; padding-right: 10px;">

                <!-- Header with Back Button -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Candidate Management</h1>
                            <p class="text-gray-600">Manage candidates for: <span class="font-semibold text-blue-600">#{param['examTheme']}</span></p>
                        </div>

                        <h:form>
                            <h:commandLink action="#{candidateExamBean.goToExamList()}"
                                           immediate="true"
                                           styleClass="bg-gradient-to-r from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white font-medium py-3 px-6 rounded-lg shadow-sm hover:shadow transition-colors inline-flex items-center">
                                <i class="fas fa-arrow-left mr-3"></i>
                                <span>Go Back</span>
                            </h:commandLink>
                        </h:form>
                    </div>
                </div>

                <!-- Status Filter Buttons -->
                <div class="mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                            <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-filter text-blue-500 mr-3"></i>
                                Filter by Status
                            </h2>

                            <div class="text-sm text-gray-600 bg-gray-100 px-4 py-2 rounded-lg">
                                <i class="fas fa-users mr-2"></i>
                                Total Candidates: <span class="font-bold">#{candidateExamBean.unconfirmedUsers.size() + candidateExamBean.confirmedUsers.size() + candidateExamBean.passedUsers.size()}</span>
                            </div>
                        </div>

                        <h:form>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <h:commandLink action="#{candidateExamBean.markUnconfirmed()}"
                                               styleClass="bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 inline-flex items-center justify-center"
                                               rendered="#{candidateExamBean.unconfirmedUsers.size() > 0}">
                                    <i class="fas fa-clock mr-3 text-xl"></i>
                                    <div class="text-left">
                                        <div class="font-bold text-lg">Unconfirmed</div>
                                        <div class="text-sm opacity-90">#{candidateExamBean.unconfirmedUsers.size()} candidates</div>
                                    </div>
                                </h:commandLink>

                                <h:commandLink action="#{candidateExamBean.markConfirmed()}"
                                               styleClass="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 inline-flex items-center justify-center"
                                               rendered="#{candidateExamBean.confirmedUsers.size() > 0}">
                                    <i class="fas fa-check-circle mr-3 text-xl"></i>
                                    <div class="text-left">
                                        <div class="font-bold text-lg">Confirmed</div>
                                        <div class="text-sm opacity-90">#{candidateExamBean.confirmedUsers.size()} candidates</div>
                                    </div>
                                </h:commandLink>

                                <h:commandLink action="#{candidateExamBean.markPassed()}"
                                               styleClass="bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 inline-flex items-center justify-center"
                                               rendered="#{candidateExamBean.passedUsers.size() > 0}">
                                    <i class="fas fa-graduation-cap mr-3 text-xl"></i>
                                    <div class="text-left">
                                        <div class="font-bold text-lg">Passed</div>
                                        <div class="text-sm opacity-90">#{candidateExamBean.passedUsers.size()} candidates</div>
                                    </div>
                                </h:commandLink>
                            </div>
                        </h:form>
                    </div>
                </div>

                <!-- Search Box -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                    <div class="relative max-w-2xl mx-auto">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text"
                               id="myInput"
                               onkeyup="searchCandidates()"
                               placeholder="Search candidates by name, email, code, or date..."
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent outline-none transition-colors"/>
                    </div>
                </div>

                <!-- Messages -->
                <h:messages globalOnly="true" styleClass="mb-6"/>

                <!-- Unconfirmed Candidates -->
                <h:panelGroup id="unconfirmedSection" rendered="#{candidateExamBean.unconfirmed}">
                    <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl shadow-sm p-6 mb-8 border-2 border-yellow-200">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-yellow-700 flex items-center">
                                <i class="fas fa-clock mr-3"></i>
                                Unconfirmed Candidates
                                <span class="ml-3 px-3 py-1 bg-yellow-100 text-yellow-700 text-sm font-bold rounded-full">
                                #{candidateExamBean.unconfirmedUsers.size()}
                            </span>
                            </h2>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <ui:repeat value="#{candidateExamBean.unconfirmedUsers}" var="user">
                                <div class="candidate-item bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition-all duration-300 border border-yellow-200">
                                    <div class="flex items-start mb-4">
                                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-user-clock text-yellow-500 text-xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-gray-800 text-lg">#{user[1]}</h3>
                                            <p class="text-gray-600 text-sm">
                                                <i class="fas fa-envelope mr-1"></i> #{user[2]}
                                            </p>
                                        </div>
                                    </div>

                                    <div class="space-y-3 mb-6">
                                        <div class="flex items-center text-sm">
                                            <i class="fas fa-calendar text-yellow-500 mr-2 w-5"></i>
                                            <span class="text-gray-700">Date: </span>
                                            <span class="font-medium ml-2">#{user[3]}</span>
                                        </div>
                                        <div class="flex items-center text-sm">
                                            <i class="fas fa-play text-yellow-500 mr-2 w-5"></i>
                                            <span class="text-gray-700">Start: </span>
                                            <span class="font-medium ml-2">#{user[4]}</span>
                                        </div>
                                        <div class="flex items-center text-sm">
                                            <i class="fas fa-flag-checkered text-yellow-500 mr-2 w-5"></i>
                                            <span class="text-gray-700">End: </span>
                                            <span class="font-medium ml-2">#{user[5]}</span>
                                        </div>
                                    </div>

                                    <h:form>
                                        <h:commandLink action="#{candidateExamBean.confirmCandidate(user[0],user[1],user[2],user[3],user[4],user[5])}"
                                                       styleClass="w-full bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white font-semibold py-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 inline-flex items-center justify-center">
                                            <i class="fas fa-check-circle mr-3"></i>
                                            <span>Confirm Candidate</span>
                                            <f:ajax render="@all"/>
                                        </h:commandLink>
                                    </h:form>
                                </div>
                            </ui:repeat>
                        </div>

                        <h:panelGroup rendered="#{empty candidateExamBean.unconfirmedUsers}">
                            <div class="text-center py-12 bg-white rounded-lg border-2 border-dashed border-yellow-300">
                                <i class="fas fa-check-circle text-5xl text-yellow-300 mb-4"></i>
                                <h3 class="text-xl font-semibold text-yellow-700 mb-2">No Unconfirmed Candidates</h3>
                                <p class="text-gray-600">All candidates have been confirmed!</p>
                            </div>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>

                <!-- Confirmed Candidates -->
                <h:panelGroup id="confirmedSection" rendered="#{candidateExamBean.confirmed}">
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm p-6 mb-8 border-2 border-green-200">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-green-700 flex items-center">
                                <i class="fas fa-check-circle mr-3"></i>
                                Confirmed Candidates
                                <span class="ml-3 px-3 py-1 bg-green-100 text-green-700 text-sm font-bold rounded-full">
                                #{candidateExamBean.confirmedUsers.size()}
                            </span>
                            </h2>
                        </div>

                        <div class="overflow-x-auto rounded-lg border border-green-200">
                            <table class="min-w-full divide-y divide-green-100">
                                <thead class="bg-gradient-to-r from-green-400 to-emerald-500">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-hashtag mr-2"></i> Code
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-user mr-2"></i> Candidate
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-envelope mr-2"></i> Email
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-calendar mr-2"></i> Date
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-clock mr-2"></i> Time Slot
                                    </th>
                                </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-green-50">
                                <ui:repeat value="#{candidateExamBean.confirmedUsers}" var="user">
                                    <tr class="candidate-item hover:bg-green-50 transition-colors duration-200">
                                        <td class="px-6 py-4">
                                            <span class="px-3 py-1 bg-green-100 text-green-700 text-sm font-bold rounded-full">
                                                #{user[0]}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                                    <i class="fas fa-user text-green-500"></i>
                                                </div>
                                                <div>
                                                    <div class="font-medium text-gray-900">#{user[2]}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-gray-700">#{user[3]}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-gray-700">#{user[4]}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm">
                                                <div class="flex items-center text-green-600">
                                                    <i class="fas fa-play mr-2"></i>
                                                    #{user[5]}
                                                </div>
                                                <div class="flex items-center text-green-600 mt-1">
                                                    <i class="fas fa-flag-checkered mr-2"></i>
                                                    #{user[6]}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                </tbody>
                            </table>
                        </div>

                        <h:panelGroup rendered="#{empty candidateExamBean.confirmedUsers}">
                            <div class="text-center py-12 bg-white rounded-lg border-2 border-dashed border-green-300">
                                <i class="fas fa-users text-5xl text-green-300 mb-4"></i>
                                <h3 class="text-xl font-semibold text-green-700 mb-2">No Confirmed Candidates</h3>
                                <p class="text-gray-600">Confirm candidates from the unconfirmed list</p>
                            </div>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>

                <!-- Passed Candidates -->
                <h:panelGroup id="passedSection" rendered="#{candidateExamBean.passed}">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm p-6 mb-8 border-2 border-blue-200">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-blue-700 flex items-center">
                                <i class="fas fa-graduation-cap mr-3"></i>
                                Passed Candidates
                                <span class="ml-3 px-3 py-1 bg-blue-100 text-blue-700 text-sm font-bold rounded-full">
                                #{candidateExamBean.passedUsers.size()}
                            </span>
                            </h2>
                        </div>

                        <div class="overflow-x-auto rounded-lg border border-blue-200">
                            <table class="min-w-full divide-y divide-blue-100">
                                <thead class="bg-gradient-to-r from-blue-400 to-indigo-500">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-hashtag mr-2"></i> Code
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-user-graduate mr-2"></i> Candidate
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-envelope mr-2"></i> Email
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-calendar mr-2"></i> Date
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-clock mr-2"></i> Time Slot
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                        <i class="fas fa-chart-line mr-2"></i> Score
                                    </th>
                                </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-blue-50">
                                <ui:repeat value="#{candidateExamBean.passedUsers}" var="user">
                                    <tr class="candidate-item hover:bg-blue-50 transition-colors duration-200">
                                        <td class="px-6 py-4">
                                            <span class="px-3 py-1 bg-blue-100 text-blue-700 text-sm font-bold rounded-full">
                                                #{user[0]}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                    <i class="fas fa-user-graduate text-blue-500"></i>
                                                </div>
                                                <div>
                                                    <div class="font-medium text-gray-900">#{user[2]}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-gray-700">#{user[3]}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-gray-700">#{user[4]}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm">
                                                <div class="flex items-center text-blue-600">
                                                    <i class="fas fa-play mr-2"></i>
                                                    #{user[5]}
                                                </div>
                                                <div class="flex items-center text-blue-600 mt-1">
                                                    <i class="fas fa-flag-checkered mr-2"></i>
                                                    #{user[6]}
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col items-start">
                                                <span class="px-3 py-1 rounded-full font-bold text-sm
                                                    #{user[7]/user[8] >= 0.7 ? 'bg-green-100 text-green-700' :
                                                      user[7]/user[8] >= 0.5 ? 'bg-yellow-100 text-yellow-700' :
                                                      'bg-red-100 text-red-700'}">
                                                    #{user[7]}/#{user[8]}
                                                </span>
                                                <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                                                    <div class="h-2 rounded-full
                                                        #{user[7]/user[8] >= 0.7 ? 'bg-green-500' :
                                                          user[7]/user[8] >= 0.5 ? 'bg-yellow-500' :
                                                          'bg-red-500'}"
                                                         style="width: #{((user[7]/user[8]) * 100).intValue()}%">
                                                    </div>
                                                </div>
                                                <span class="text-xs text-gray-500 mt-1">
                                                    #{((user[7]/user[8]) * 100).intValue()}%
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                </tbody>
                            </table>
                        </div>

                        <h:panelGroup rendered="#{empty candidateExamBean.passedUsers}">
                            <div class="text-center py-12 bg-white rounded-lg border-2 border-dashed border-blue-300">
                                <i class="fas fa-graduation-cap text-5xl text-blue-300 mb-4"></i>
                                <h3 class="text-xl font-semibold text-blue-700 mb-2">No Passed Candidates</h3>
                                <p class="text-gray-600">Candidates will appear here after completing the exam</p>
                            </div>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>

            </div> <!-- End of scrollable container -->

            <!-- JavaScript for search functionality -->
            <script>
                function searchCandidates() {
                    const input = document.getElementById('myInput');
                    const filter = input.value.toLowerCase();
                    const items = document.querySelectorAll('.candidate-item');

                    items.forEach(item => {
                        const text = item.textContent || item.innerText;
                        item.style.display = text.toLowerCase().includes(filter) ? '' : 'none';
                    });
                }

                // Initialize search on page load
                document.addEventListener('DOMContentLoaded', function() {
                    const searchInput = document.getElementById('myInput');
                    if (searchInput) {
                        searchInput.addEventListener('keyup', function(event) {
                            if (event.key === 'Enter') {
                                searchCandidates();
                            }
                        });
                    }

                    // Initial search to show all items
                    searchCandidates();
                });
            </script>

            <!-- Custom styles -->
            <style>
                /* Custom scrollbar for content area */
                div[style*="height: calc(100vh"]::-webkit-scrollbar {
                    width: 8px;
                }

                div[style*="height: calc(100vh"]::-webkit-scrollbar-track {
                    background: #f1f5f9;
                    border-radius: 4px;
                }

                div[style*="height: calc(100vh"]::-webkit-scrollbar-thumb {
                    background: #cbd5e1;
                    border-radius: 4px;
                }

                div[style*="height: calc(100vh"]::-webkit-scrollbar-thumb:hover {
                    background: #94a3b8;
                }

                /* Remove scrollbar from main page */
                html, body {
                    overflow: hidden;
                    height: 100%;
                }

                /* Make sure main content doesn't overflow */
                main {
                    height: 100vh;
                    overflow: hidden;
                }

                /* Better focus styles */
                input:focus, button:focus, a:focus {
                    outline: none;
                    ring: 2px;
                    ring-color: rgba(96, 165, 250, 0.5);
                }

                /* Style for commandLinks to look like buttons */
                a[style*="gradient"] {
                    text-decoration: none;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                }

                /* Ensure inline-flex works properly */
                .inline-flex {
                    display: inline-flex !important;
                }

                /* Smooth transitions */
                .transition-colors {
                    transition: all 0.2s ease;
                }

                /* Table hover effects */
                tr:hover {
                    transition: all 0.3s ease;
                }
            </style>
        </ui:define>
    </ui:composition>
</f:view>
</html>
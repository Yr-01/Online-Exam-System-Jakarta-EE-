<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:h="jakarta.faces.html">
<f:view>
    <h:head>
        <title>Browse Exams - QuickExam</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Tailwind CSS -->
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet" />

        <style>
            :root {
                --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }

            body {
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #fdf6f0 0%, #f5f1ff 50%, #f0f8ff 100%);
                min-height: 100vh;
                scroll-behavior: smooth;
            }

            .gradient-text {
                background: var(--primary-gradient);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .glass-card {
                background: rgba(255, 255, 255, 0.85);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
            }

            .exam-card {
                transition: all 0.3s ease;
                transform: translateY(0);
            }

            .exam-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            }

            .btn-primary {
                background: var(--primary-gradient);
                transition: all 0.3s ease;
                border: none;
                cursor: pointer;
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            }

            .btn-secondary {
                background: var(--secondary-gradient);
                transition: all 0.3s ease;
                border: none;
                cursor: pointer;
            }

            .btn-secondary:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(245, 87, 108, 0.3);
            }

            .category-chip {
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .category-chip:hover {
                transform: scale(1.05);
            }

            .search-box {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(10px);
            }

            .fade-in {
                animation: fadeIn 0.5s ease-in;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .pulse {
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
                100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
            }

            .smooth-scroll {
                scroll-behavior: smooth;
            }

            /* Custom scrollbar for better UX */
            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(to bottom, #667eea, #764ba2);
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(to bottom, #764ba2, #667eea);
            }

            /* Modal animation */
            .modal-enter {
                animation: modalFadeIn 0.3s ease-out;
            }

            @keyframes modalFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            /* Exam type badge */
            .exam-type-badge {
                display: inline-block;
                padding: 0.25rem 0.75rem;
                border-radius: 9999px;
                font-size: 0.75rem;
                font-weight: 600;
                margin-top: 0.5rem;
            }

            /* Pagination styles */
            .pagination-btn {
                padding: 0.5rem 1rem;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                background-color: white;
                color: #374151;
                transition: all 0.2s;
            }

            .pagination-btn:hover:not(:disabled) {
                background-color: #f3f4f6;
                border-color: #9ca3af;
            }

            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .pagination-btn.active {
                background: var(--primary-gradient);
                color: white;
                border-color: transparent;
            }
        </style>
    </h:head>
    <h:body class="min-h-screen smooth-scroll">

        <!-- Header -->
        <ui:include src="/views/layouts/header.xhtml" />

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Page Header -->
            <div class="mb-12 text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">
                    <span class="gradient-text">Browse Exams</span>
                </h1>
                <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                    Find the perfect exam to test your knowledge. Filter by category, or search for specific topics.
                </p>
            </div>

            <!-- Search and Filter Section -->
            <div class="glass-card rounded-2xl p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <!-- Search Box -->
                    <div class="flex-grow">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <input type="text"
                                   id="examSearchInput"
                                   placeholder="Search exams by theme, creator, type, or keywords..."
                                   class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent shadow-sm search-box" />
                        </div>
                    </div>

                    <!-- Filter Buttons -->
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterByCategory('all')" class="category-chip px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-full text-sm font-medium hover:shadow-md transition-shadow">
                            All Exams
                        </button>
                    </div>
                </div>

                <!-- Stats Bar -->
                <div class="flex flex-wrap gap-4 mt-6 pt-6 border-t border-gray-100">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-100 to-blue-100 flex items-center justify-center mr-3">
                            <i class="fas fa-book text-purple-600"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Total Exams</div>
                            <div id="totalExamsCount" class="font-bold text-gray-800">#{examController.allExams.size()}</div>
                        </div>
                    </div>
                    <!-- Add this to your stats bar section -->
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-100 to-cyan-100 flex items-center justify-center mr-3">
                            <i class="fas fa-filter text-blue-600"></i>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Showing</div>
                            <div id="showingCount" class="font-bold text-gray-800">#{examController.allExams.size()}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exams Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="examGrid">
                <ui:repeat value="#{examController.allExams}" var="exam" varStatus="status">
                    <div class="exam-card glass-card rounded-2xl p-6 fade-in" data-exam-index="#{status.index}">
                        <!-- Exam Header -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-1">#{exam[1]}</h3>
                                <div class="flex items-center text-gray-500 text-sm">
                                    <i class="fas fa-user-circle mr-1"></i>
                                    <span>By #{exam[5]}</span>
                                </div>
                            </div>
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white text-lg">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                        </div>

                        <!-- Exam Details -->
                        <div class="space-y-3 mb-6">
                            <div class="flex items-center text-gray-600">
                                <i class="fas fa-question-circle text-purple-500 mr-3 w-5"></i>
                                <span>#{exam[3]} questions</span>
                            </div>
                            <div class="flex items-center text-gray-600">
                                <i class="fas fa-clock text-blue-500 mr-3 w-5"></i>
                                <span>#{exam[4]} minutes</span>
                            </div>
                            <div>
                                <span class="exam-type-badge bg-gradient-to-r from-purple-100 to-blue-100 text-purple-700">
                                    #{exam[2]}
                                </span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-3">
                            <h:form>
                                <h:commandLink action="#{candidateExamBean.showRegisterDetailForm(exam[0], exam[4], exam[1],exam[4], exam[1])}"
                                               styleClass="btn-primary text-white font-semibold py-3 px-6 rounded-xl flex-grow flex items-center justify-center gap-2 no-underline">
                                    <i class="fas fa-calendar-plus"></i>
                                    <span>Register Now</span>
                                    <f:ajax execute="@this" render=":registerContainer :registerForm" />
                                </h:commandLink>
                            </h:form>
                        </div>
                    </div>
                </ui:repeat>
            </div>

            <!-- Empty State -->
            <ui:fragment rendered="#{empty examController.allExams}">
                <div class="text-center py-16 glass-card rounded-2xl">
                    <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 flex items-center justify-center">
                        <i class="fas fa-book text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-700 mb-2">No Exams Available</h3>
                    <p class="text-gray-600 mb-6 max-w-md mx-auto">There are no exams available at the moment. Please check back later or contact the administrator.</p>
                    <h:link outcome="/index.xhtml" styleClass="btn-primary px-6 py-3 text-white font-semibold rounded-xl inline-flex items-center">
                        <i class="fas fa-home mr-2"></i>
                        Return Home
                    </h:link>
                </div>
            </ui:fragment>

            <!-- Pagination Controls -->
            <div class="mt-12 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-gray-600 text-sm">
                    Showing <span id="pageStart">1</span> to <span id="pageEnd">6</span> of <span id="totalFiltered">#{examController.allExams.size()}</span> exams
                </div>
                <div class="flex items-center gap-2">
                    <button id="prevPageBtn" onclick="changePage(-1)" disabled="disabled" class="pagination-btn">
                        <i class="fas fa-chevron-left mr-2"></i> Previous
                    </button>
                    <div class="flex gap-1" id="pageNumbers">
                        <!-- Page numbers will be generated here -->
                    </div>
                    <button id="nextPageBtn" onclick="changePage(1)" class="pagination-btn">
                        Next <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Registration Form Modal -->
            <h:panelGroup id="registerContainer" layout="block">
                <h:panelGroup id="registerForm" rendered="#{candidateExamBean.showRegisterForm}">
                    <!-- Modal Overlay -->
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-enter">
                        <div class="glass-card rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                            <div class="p-6">
                                <!-- Modal Header -->
                                <div class="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-800">Register for Exam</h2>
                                        <p class="text-gray-600">Complete the form to schedule your exam</p>
                                    </div>
                                    <h:commandLink action="#{candidateExamBean.cancelRegisterForm()}"
                                                   class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 no-underline">
                                        <i class="fas fa-times text-xl"></i>
                                        <f:ajax execute="@this" render=":registerContainer :registerForm" />
                                    </h:commandLink>
                                </div>

                                <!-- Exam Info -->
                                <div class="mb-6 p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white mr-4">
                                            <i class="fas fa-graduation-cap"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-800">#{candidateExamBean.selectedExamTheme}</h4>
                                            <div class="flex items-center text-sm text-gray-600">
                                                <span class="mr-4">
                                                    <i class="fas fa-clock mr-1"></i>
                                                    #{candidateExamBean.selectedExamDuration} min
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Registration Form -->
                                <h:form id="registrationForm">
                                    <div class="space-y-6">
                                        <!-- Exam Date -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-calendar-alt mr-2 text-purple-500"></i>
                                                Exam Date
                                            </label>
                                            <h:inputText value="#{candidateExamBean.date}"
                                                         required="true"
                                                         type="date"
                                                         styleClass="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                         requiredMessage="Please select an exam date">
                                                <f:convertDateTime type="localDate" pattern="yyyy-MM-dd"/>
                                            </h:inputText>
                                            <h:message for="registrationForm:date" styleClass="text-red-500 text-sm mt-1" />
                                        </div>

                                        <!-- Start Time -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-clock mr-2 text-blue-500"></i>
                                                Start Time
                                            </label>
                                            <h:inputText value="#{candidateExamBean.startTime}"
                                                         required="true"
                                                         type="time"
                                                         styleClass="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                         requiredMessage="Please select a start time">
                                                <f:convertDateTime type="localTime" pattern="HH:mm"/>
                                                <f:ajax event="change" listener="#{candidateExamBean.calculateEndTime()}" render="endTimeDisplay"/>
                                            </h:inputText>
                                            <h:message for="registrationForm:startTime" styleClass="text-red-500 text-sm mt-1" />
                                        </div>

                                        <!-- End Time (Calculated) -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-flag-checkered mr-2 text-green-500"></i>
                                                Estimated End Time
                                            </label>
                                            <h:inputText id="endTimeDisplay"
                                                         value="#{candidateExamBean.endTime}"
                                                         readonly="true"
                                                         type="time"
                                                         styleClass="w-full px-4 py-3 border border-gray-200 bg-gray-50 rounded-xl focus:outline-none">
                                                <f:convertDateTime type="localTime" pattern="HH:mm"/>
                                            </h:inputText>
                                            <p class="text-sm text-gray-500 mt-1">Calculated based on exam duration</p>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="flex gap-3 pt-4">
                                            <h:commandLink
                                                             action="#{candidateExamBean.saveRegisterForm()}"
                                                             styleClass="btn-primary text-white font-semibold py-3 px-8 rounded-xl flex-grow flex items-center justify-center">
                                                <i class="fas fa-check-circle mr-2"></i>
                                                Confirm Registration
                                                <f:ajax execute="@form" render=":registerContainer" />
                                            </h:commandLink>

                                            <h:commandButton value="Cancel"
                                                             action="#{candidateExamBean.cancelRegisterForm()}"
                                                             styleClass="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-colors">
                                                <f:ajax execute="@this" render=":registerContainer :registerForm" />
                                            </h:commandButton>
                                        </div>
                                    </div>
                                </h:form>
                            </div>
                        </div>
                    </div>
                </h:panelGroup>
            </h:panelGroup>


        </main>

        <!-- Footer -->
        <ui:include src="/views/layouts/footer.xhtml" />

        <!-- JavaScript -->
        <script>
            //<![CDATA[
            // Pagination variables
            let currentPage = 1;
            let examsPerPage = 6;
            let filteredExams = [];

            // Initialize when DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {
                initializeExams();
                setupSearch();
                renderPagination();
            });

            // Initialize exams array
            function initializeExams() {
                const examCards = document.querySelectorAll('.exam-card');
                filteredExams = Array.from(examCards);
                updateDisplay();
            }

            // Setup search functionality
            function setupSearch() {
                const searchInput = document.getElementById('examSearchInput');

                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();

                    filteredExams = Array.from(document.querySelectorAll('.exam-card')).filter(card => {
                        const examText = card.textContent.toLowerCase();
                        return searchTerm === '' || examText.includes(searchTerm);
                    });

                    currentPage = 1; // Reset to first page on search
                    updateDisplay();
                    renderPagination();
                });
            }

            // Filter by category
            function filterByCategory(category) {
                if (category === 'all') {
                    filteredExams = Array.from(document.querySelectorAll('.exam-card'));
                } else {
                    filteredExams = Array.from(document.querySelectorAll('.exam-card')).filter(card => {
                        const examType = card.querySelector('.exam-type-badge').textContent.toLowerCase();
                        return examType.includes(category);
                    });
                }

                currentPage = 1;
                updateDisplay();
                renderPagination();
            }

            // Update display based on current page
            function updateDisplay() {
                const examCards = document.querySelectorAll('.exam-card');
                const totalExams = examCards.length;
                const totalFiltered = filteredExams.length;

                // Hide all exams first
                examCards.forEach(card => {
                    card.style.display = 'none';
                });

                // Calculate start and end indices for current page
                const startIndex = (currentPage - 1) * examsPerPage;
                const endIndex = Math.min(startIndex + examsPerPage, totalFiltered);

                // Show exams for current page
                for (let i = startIndex; i < endIndex; i++) {
                    if (filteredExams[i]) {
                        filteredExams[i].style.display = 'block';
                    }
                }

                // Update counters
                document.getElementById('showingCount').textContent = Math.min(examsPerPage, totalFiltered);
                document.getElementById('pageStart').textContent = totalFiltered > 0 ? startIndex + 1 : 0;
                document.getElementById('pageEnd').textContent = endIndex;
                document.getElementById('totalFiltered').textContent = totalFiltered;
            }

            // Change page
            function changePage(direction) {
                const totalPages = Math.ceil(filteredExams.length / examsPerPage);

                currentPage += direction;

                // Ensure page is within bounds
                if (currentPage < 1) currentPage = 1;
                if (currentPage > totalPages) currentPage = totalPages;

                updateDisplay();
                renderPagination();

                // Scroll to top of exam grid
                document.getElementById('examGrid').scrollIntoView({ behavior: 'smooth' });
            }

            // Render pagination controls
            function renderPagination() {
                const totalPages = Math.ceil(filteredExams.length / examsPerPage);
                const pageNumbersContainer = document.getElementById('pageNumbers');
                const prevBtn = document.getElementById('prevPageBtn');
                const nextBtn = document.getElementById('nextPageBtn');

                // Update previous/next buttons
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages || totalPages === 0;

                // Clear existing page numbers
                pageNumbersContainer.innerHTML = '';

                // Calculate page range to display
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);

                // Adjust start page if we're at the end
                if (endPage - startPage < 4 && startPage > 1) {
                    startPage = Math.max(1, endPage - 4);
                }

                // Create page number buttons
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = 'pagination-btn';
                    if (i === currentPage) {
                        pageBtn.classList.add('active');
                    }
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => {
                        currentPage = i;
                        updateDisplay();
                        renderPagination();
                    };
                    pageNumbersContainer.appendChild(pageBtn);
                }

                // Add ellipsis if needed
                if (endPage < totalPages) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'px-2 text-gray-500';
                    ellipsis.textContent = '...';
                    pageNumbersContainer.appendChild(ellipsis);

                    const lastPageBtn = document.createElement('button');
                    lastPageBtn.className = 'pagination-btn';
                    lastPageBtn.textContent = totalPages;
                    lastPageBtn.onclick = () => {
                        currentPage = totalPages;
                        updateDisplay();
                        renderPagination();
                    };
                    pageNumbersContainer.appendChild(lastPageBtn);
                }
            }

            // Modal functions
            function closeRegistrationModal() {
                const cancelBtn = document.querySelector('button[value="Cancel"]');
                if (cancelBtn) {
                    cancelBtn.click();
                }
            }

            // Close modal on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeRegistrationModal();
                }
            });
            //]]>
        </script>

    </h:body>
</f:view>
</html>